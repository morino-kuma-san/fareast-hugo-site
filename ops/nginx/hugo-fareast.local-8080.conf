# nginx 設定: 自宅ローカル開発用（ポート8080）
# 生成日: 2026-01-31

server {
    listen 8080;
    server_name localhost;

    # 自宅環境用パス
    root /home/yasuhiro/ドキュメント/fareast-hugo-site/public;

    index index.html;

    # 静的ファイル（Hugo生成）
    location / {
        try_files $uri $uri/ =404;
    }

    # /api/sp-inquiry → Node(8787)
    location = /api/sp-inquiry {
        limit_except POST { deny all; }

        proxy_pass http://127.0.0.1:8787;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        client_max_body_size 64k;
    }

    # /mypage → Node(8787) + rate limit
    location ^~ /mypage {
        proxy_pass http://127.0.0.1:8787;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        client_max_body_size 64k;

        limit_except GET POST { deny all; }
    }

    # /staff → Node(8787) + Basic認証
    location ^~ /staff {
        auth_basic "Staff Only";
        auth_basic_user_file /etc/nginx/.htpasswd_staff;

        proxy_pass http://127.0.0.1:8787;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        limit_except GET POST { deny all; }
    }

    # ヘルスチェック
    location = /healthz {
        proxy_pass http://127.0.0.1:8787;
    }
}
